{"version":3,"file":"wavToMp3.umd.js","sources":["../src/wavToMp3.ts"],"sourcesContent":["/**\n * use [lamejs](https://github.com/zhuker/lamejs#real-example) to encode mp3\n * @todo\n *  - [ ] to `ts`\n */\n\nimport lamejs from 'lamejs'\n\nexport default function wavToMp3 (buffers: Array<ArrayBuffer>): Promise<Array<ArrayBuffer>> {\n  return Promise.all<ArrayBuffer>(buffers.map((buf) => new Promise((resolve, reject) => {\n    const wav = lamejs.WavHeader.readHeader(new DataView(buf))\n    const samples = new Int16Array(buf, wav.dataOffset, wav.dataLen / 2)\n    const buffer = [ ]\n    const mp3enc = new lamejs.Mp3Encoder(wav.channels, wav.sampleRate, 128)\n\n    let remaining = samples.length\n    const maxSamples = 1152\n    for (let i = 0; remaining >= maxSamples; i += maxSamples) {\n      const mono = samples.subarray(i, i + maxSamples)\n      const mp3buf = mp3enc.encodeBuffer(mono)\n      if (mp3buf.length > 0) {\n        buffer.push(new Int8Array(mp3buf))\n      }\n      remaining -= maxSamples\n    }\n\n    const flush = mp3enc.flush()\n    if (flush.length > 0){\n      buffer.push(new Int8Array(flush))\n    }\n\n    const blob = new Blob(buffer, { type: 'audio/mpeg' })\n    const reader = new FileReader()\n    reader.addEventListener('load', () => {\n      resolve(reader.result as ArrayBuffer)\n    })\n    reader.addEventListener('error', (error) => {\n      reject(error)\n    })\n\n    reader.readAsArrayBuffer(blob)\n  })))\n}\n"],"names":[],"mappings":";;;;;;;;EAAA;;;;;AAMA,WAEwB,QAAQ,CAAE,OAA2B;MAC3D,OAAO,OAAO,CAAC,GAAG,CAAc,OAAO,CAAC,GAAG,CAAC,UAAC,GAAG,IAAK,OAAA,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;UAC/E,IAAM,GAAG,GAAG,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAA;UAC1D,IAAM,OAAO,GAAG,IAAI,UAAU,CAAC,GAAG,EAAE,GAAG,CAAC,UAAU,EAAE,GAAG,CAAC,OAAO,GAAG,CAAC,CAAC,CAAA;UACpE,IAAM,MAAM,GAAG,EAAG,CAAA;UAClB,IAAM,MAAM,GAAG,IAAI,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,QAAQ,EAAE,GAAG,CAAC,UAAU,EAAE,GAAG,CAAC,CAAA;UAEvE,IAAI,SAAS,GAAG,OAAO,CAAC,MAAM,CAAA;UAC9B,IAAM,UAAU,GAAG,IAAI,CAAA;UACvB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,SAAS,IAAI,UAAU,EAAE,CAAC,IAAI,UAAU,EAAE;cACxD,IAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,CAAA;cAChD,IAAM,MAAM,GAAG,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,CAAA;cACxC,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;kBACrB,MAAM,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC,MAAM,CAAC,CAAC,CAAA;eACnC;cACD,SAAS,IAAI,UAAU,CAAA;WACxB;UAED,IAAM,KAAK,GAAG,MAAM,CAAC,KAAK,EAAE,CAAA;UAC5B,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAC;cACnB,MAAM,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC,KAAK,CAAC,CAAC,CAAA;WAClC;UAED,IAAM,IAAI,GAAG,IAAI,IAAI,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,YAAY,EAAE,CAAC,CAAA;UACrD,IAAM,MAAM,GAAG,IAAI,UAAU,EAAE,CAAA;UAC/B,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE;cAC9B,OAAO,CAAC,MAAM,CAAC,MAAqB,CAAC,CAAA;WACtC,CAAC,CAAA;UACF,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,UAAC,KAAK;cACrC,MAAM,CAAC,KAAK,CAAC,CAAA;WACd,CAAC,CAAA;UAEF,MAAM,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAA;OAC/B,CAAC,GAAA,CAAC,CAAC,CAAA;EACN,CAAC;;;;;;;;"}