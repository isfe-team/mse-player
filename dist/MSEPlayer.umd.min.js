!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).MSEPlayer=r()}(this,function(){"use strict";function p(e,r){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var t,o,i=n.call(e),u=[];try{for(;(void 0===r||0<r--)&&!(t=i.next()).done;)u.push(t.value)}catch(e){o={error:e}}finally{try{t&&!t.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return u}function l(e){var n=this;void 0===e&&(e={});var r=e.files,t=void 0===r?[]:r,o=e.mimeType,i=void 0===o?"audio/mpeg":o,u=e.onError,f=e.ignoreError,c=void 0===f||f,s=e.transformer,d=void 0===s?h:s;if(this.envSupported=l.checkEnvSupported(),this.onError=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];!function(e){return"[object Function]"===Object.prototype.toString.call(e)}(u)||u.call.apply(u,function(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(p(arguments[r]));return e}([n],e))},this.envSupported)if(MediaSource.isTypeSupported(i)){this.mimeType=i,this.sourceBuffer=null,this.ignoreError=c,this.transformer=d,this.mediaSource=new MediaSource;var a=this;this.lastAppend$=new Promise(function(r){var n=a.mediaSource;n.addEventListener("sourceopen",function e(){n.removeEventListener("sourceopen",e),a.sourceBuffer=n.addSourceBuffer(a.mimeType),r()})}),0<t.length&&this.appendFiles(t)}else this.onError(v("MIME_TYPE_NOT_SUPPORTED"));else this.onError(v("MEDIA_SOURCE_NOT_SUPPORTED"))}function h(e){return e}function v(e,r){return{type:e,error:r}}return l.checkEnvSupported=function(){return"MediaSource"in window},l.prototype.appendFiles=function(e,r,n){var t=this;function o(e){return Promise.resolve(e).then(r).then(function(e){return t.transformer(e)})}void 0===e&&(e=[]),void 0===r&&(r=h),void 0===n&&(n=!0),e=function(e){return[].slice.call(e)}(e),n&&this.lastAppend$.catch(function(){});var i=this.lastAppend$.then(function(){return function(e,r,n,t){return function(e){return Promise.all(e.map(function(t){return new Promise(function(e,r){var n=new FileReader;n.addEventListener("load",function(){e(n.result)}),n.readAsArrayBuffer(t),n.addEventListener("error",function(e){r(v("READ_FILE_ERROR",e))})})}))}(e).then(function(e){return t(e)}).then(function(e){return function(o,i,u){return new Promise(function(e,r){function n(){if(0===u.length)return o.endOfStream(),i.removeEventListener("updateend",n),i.removeEventListener("error",t),void e();i.appendBuffer(u.shift())}function t(e){r(v("APPEND_BUFFER_ERROR",e))}i.addEventListener("updateend",n),i.addEventListener("error",t),n()})}(r,n,e)})}(e,t.mediaSource,t.sourceBuffer,o)});return this.lastAppend$=i.catch(function(e){t.onError(v("APPEND_ERROR",e))}),this.ignoreError?this.lastAppend$:i},l.prototype.destroy=function(){this.mediaSource=null,this.sourceBuffer=null},l});
//# sourceMappingURL=MSEPlayer.umd.min.js.map
